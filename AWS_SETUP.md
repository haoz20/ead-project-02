# AWS and Docker Setup Guide

## Prerequisites
1. AWS Account with RDS PostgreSQL instance
2. AWS S3 bucket for video storage (private bucket)
3. AWS IAM credentials with appropriate permissions

## Required IAM Permissions
Your IAM user/role needs:
- S3: `PutObject`, `GetObject`, `ListBucket`
- RDS: Network access to your RDS instance

## Setup Steps

### 1. Configure RDS Database
1. Create a PostgreSQL instance in AWS RDS
2. Note down the endpoint, port, database name, username, and password
3. Ensure your security group allows connections (port 5432)
4. Enable SSL/TLS for secure connections

### 2. Configure S3 Bucket
1. Create a **private** S3 bucket for video storage
2. Keep the bucket private (no public access)
3. Videos will be accessed via presigned URLs generated by the backend
4. Note down the bucket name

### 3. Update .env File
Edit the `.env` file in the project root with your actual AWS values:

```env
# Backend Configuration
PORT=4000

# AWS Configuration
AWS_REGION=us-east-1                          # Your AWS region
AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE        # Your access key
AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY

# S3 Configuration
S3_BUCKET_NAME=my-video-bucket                # Your S3 bucket name

# Database Configuration (AWS RDS PostgreSQL)
DB_HOST=mydb.123456789012.us-east-1.rds.amazonaws.com
DB_PORT=5432
DB_NAME=videodb
DB_USER=postgres
DB_PASSWORD=your-secure-password
DB_SSL=true
```

### 4. Run with Docker

```bash
# Build and start containers
docker compose up --build

# Or run in detached mode
docker compose up -d --build
```

### 5. Database Initialization
The database table will be created automatically on first run. The schema includes:
- `id` (UUID primary key)
- `title` (video title)
- `description` (optional description)
- `filename` (file name in S3)
- `s3_key` (full S3 key/path)
- `mime_type` (video MIME type)
- `original_name` (original uploaded filename)
- `uploaded_at` (upload timestamp)

## Architecture Overview

**Storage**: Videos are uploaded directly to a private AWS S3 bucket (no local storage)

**Database**: Video metadata stored in AWS RDS PostgreSQL

**Delivery**: Videos served via S3 presigned URLs
- Presigned URLs are generated on-demand by the backend
- URLs expire after 1 hour for security
- No public access to S3 bucket needed

**Frontend**: React app built with Vite, connects to backend API

**Backend**: Express.js server handling uploads and video metadata

## Notes

- S3 bucket should remain **private** - no public access required
- Presigned URLs expire after 1 hour (configurable in `src/s3.js`)
- Maximum upload size is 500MB (configurable in `src/s3.js`)
- SSL/TLS is enabled for database connections for security
- All environment variables are loaded from `.env` file

## Troubleshooting

**Database connection fails**: 
- Check RDS security group allows your IP/Docker network
- Verify credentials and endpoint
- Ensure SSL is properly configured

**S3 upload fails**:
- Verify IAM credentials have S3 write permissions
- Check bucket name is correct
- Ensure bucket region matches AWS_REGION

**Videos won't play**:
- Verify presigned URLs are being generated correctly
- Check that IAM credentials have GetObject permission
- Ensure S3 bucket is in the same region as configured
